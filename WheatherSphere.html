<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Weather Forecast UI</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Configure custom Tailwind settings and use Inter font */
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap");

      :root {
        --background: #000000; /* Deep Black for Contrast */
        --glass-base: rgba(31, 41, 55, 0.4); /* Semi-transparent Dark Base */
        --text-primary: #f9fafb; /* White */
        --text-secondary: #9ca3af; /* Gray-400 */
        --accent: #3b82f6; /* Blue-500 */
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--background);
        color: var(--text-primary);
        /* Subtle background texture/gradient for depth */
        background-image: linear-gradient(135deg, #0f172a 0%, #000000 100%);
      }

      /* Glassmorphism Effect for all cards */
      .card {
        background-color: var(--glass-base);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(12px); /* The Frosted Glass Effect */
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        transition: all 0.3s ease;
      }

      .card:hover {
        box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.5);
      }

      /* Dynamic Background for the Main Card (Controlled by JS) */
      #current-weather {
        /* Fallback and base style, will be overwritten by JS dynamic gradients */
        background-image: linear-gradient(
          145deg,
          rgba(55, 65, 81, 0.5) 0%,
          rgba(17, 24, 39, 0.5) 100%
        );
      }

      /* Custom scrollbar for hourly forecast */
      .hourly-scroll::-webkit-scrollbar {
        height: 6px;
      }

      .hourly-scroll::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: 10px;
      }

      .hourly-scroll::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      /* Loading spinner */
      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid var(--accent);
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
    <link
      rel="icon"
      type="image/png"
      href="https://i.postimg.cc/ZKNYWr7F/weather-2019-02-07.webp"
    />
  </head>
  <body class="min-h-screen p-4 sm:p-8 lg:p-12">
    <div class="max-w-4xl mx-auto">
      <!-- Header & Search -->
      <header class="mb-10 p-6 card rounded-2xl">
        <h1 class="text-4xl font-extrabold mb-4 text-center text-white">
          <svg
            class="w-8 h-8 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 5V3m0 18v-2M7.05 7.05 5.636 5.636m12.728 12.728L16.95 16.95M5 12H3m18 0h-2M7.05 16.95l-1.414 1.414M18.364 5.636 16.95 7.05M16 12a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z"
            />
          </svg>
          WeatherSphere
        </h1>
        <div class="flex flex-col sm:flex-row gap-4 mb-4">
          <input
            type="text"
            id="city-input"
            placeholder="Enter City (e.g., Kalyan)"
            class="flex-grow p-3 rounded-xl bg-gray-600/40 text-white placeholder-gray-400 border border-transparent focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
            value="Mumbai"
          />
          <button
            id="search-button"
            class="p-3 rounded-xl bg-blue-600 hover:bg-blue-700 text-white font-semibold transition shadow-lg shadow-blue-500/30 whitespace-nowrap flex items-center justify-center sm:w-auto"
          >
            <!-- Search Icon SVG -->
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="mr-2"
            >
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.3-4.3" />
            </svg>
            Search
          </button>
        </div>

        <!-- Unit Toggle Feature -->
        <div class="mt-4 flex justify-between items-center">
          <p id="current-time" class="text-sm text-gray-300">---</p>
          <button
            id="unit-toggle"
            class="px-3 py-1 rounded-full bg-gray-900/40 text-gray-300 font-medium text-sm hover:bg-gray-800/60 transition"
          >
            Switch to °F
          </button>
        </div>

        <!-- Message/Error Box -->
        <div
          id="message-box"
          class="mt-4 p-3 bg-red-800/80 text-red-100 rounded-lg hidden font-medium backdrop-blur-sm"
        ></div>
        <div
          id="loading-indicator"
          class="mt-4 hidden flex justify-center items-center"
        >
          <div class="spinner"></div>
          <span class="ml-3 text-gray-400">Fetching forecast...</span>
        </div>
      </header>

      <!-- Weather Display Container -->
      <main id="weather-container" class="space-y-6 hidden">
        <!-- Current Weather & Location Card (Dynamic Styling Applied by JS) -->
        <div
          id="current-weather"
          class="card p-8 md:p-10 rounded-3xl flex flex-col md:flex-row items-center justify-between transition-all duration-500"
        >
          <!-- Location and Primary Info -->
          <div class="text-center md:text-left mb-8 md:mb-0">
            <h2
              id="location-name"
              class="text-5xl sm:text-6xl font-extrabold text-white mb-2 leading-tight"
            >
              ---
            </h2>
            <p
              id="weather-description"
              class="text-2xl sm:text-3xl font-medium capitalize text-gray-200 mb-6"
            >
              ---
            </p>

            <div
              class="flex items-center justify-center md:justify-start space-x-6"
            >
              <!-- Dynamic Icon Holder -->
              <div
                id="weather-icon-wrapper"
                class="p-4 rounded-full border-2 border-white/20 transition-all duration-500 shadow-xl"
              >
                <div
                  id="weather-icon"
                  class="text-6xl sm:text-8xl transition-transform duration-500"
                >
                  ☀️
                </div>
              </div>

              <div>
                <p id="current-temp" class="text-7xl sm:text-8xl font-light">
                  --°
                </p>
              </div>
            </div>
          </div>

          <!-- Detailed Metrics -->
          <div
            id="detailed-metrics"
            class="grid grid-cols-2 gap-4 w-full md:w-auto md:min-w-[200px] mt-6 md:mt-0"
          >
            <!-- Metric Item Template -->
            <div
              class="flex flex-col items-center p-4 card rounded-xl bg-white/10 hover:bg-white/20"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-7 h-7 text-blue-300 mb-1"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 2v2" />
                <path d="M15 4.5l-1.8 1.8" />
                <path d="M22 12h-2" />
                <path d="M15 19.5l-1.8-1.8" />
                <path d="M4 12H2" />
                <path d="M6.6 6.6l-1.8 1.8" />
                <path d="M12 22v-2" />
                <path d="M9 19.5l1.8-1.8" />
                <circle cx="12" cy="12" r="5" />
              </svg>
              <span id="wind-speed" class="text-xl font-bold">--</span>
              <span id="wind-unit" class="text-xs text-gray-400"
                >Wind (km/h)</span
              >
            </div>

            <div
              class="flex flex-col items-center p-4 card rounded-xl bg-white/10 hover:bg-white/20"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-7 h-7 text-green-300 mb-1"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M10 12h.01" />
                <path d="M14 12h.01" />
                <path d="M2 12s4-8 10-8 10 8 10 8-4 8-10 8-10-8-10-8Z" />
              </svg>
              <span id="humidity" class="text-xl font-bold">--%</span>
              <span class="text-xs text-gray-400">Humidity</span>
            </div>

            <div
              class="flex flex-col items-center p-4 card rounded-xl bg-white/10 hover:bg-white/20"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-7 h-7 text-red-300 mb-1"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M12 10a7 7 0 0 0-7 7c0 1.63 0 3 0 3s.34-1.2 1.5-2c1-1 2.45-2 5.5-2s4.5 1 5.5 2c1.16.8 1.5 2 1.5 2s0-1.37 0-3a7 7 0 0 0-7-7"
                />
              </svg>
              <span id="uv-index" class="text-xl font-bold">--</span>
              <span class="text-xs text-gray-400">UV Index</span>
            </div>

            <div
              class="flex flex-col items-center p-4 card rounded-xl bg-white/10 hover:bg-white/20"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-7 h-7 text-yellow-300 mb-1"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M20.9 11c-.4.4-.7.8-1.1 1.2M3.1 13c.4-.4.7-.8 1.1-1.2M12 21v-2M12 5V3M21 12h-2M5 12H3M6.6 6.6L4.5 4.5M19.5 19.5L17.4 17.4M6.6 17.4L4.5 19.5M19.5 4.5L17.4 6.6"
                />
                <circle cx="12" cy="12" r="2" />
              </svg>
              <span id="pressure" class="text-xl font-bold">--</span>
              <span id="pressure-unit" class="text-xs text-gray-400"
                >Pressure (hPa)</span
              >
            </div>
          </div>
        </div>

        <!-- Hourly Forecast (Scrollable) -->
        <div class="card p-6 rounded-3xl">
          <h3 class="text-xl font-semibold mb-4 text-white">24-Hour Outlook</h3>
          <div
            id="hourly-forecast-list"
            class="flex overflow-x-auto space-x-4 pb-2 hourly-scroll"
          >
            <!-- Hourly items will be injected here -->
          </div>
        </div>

        <!-- 5-Day Forecast -->
        <div class="card p-6 rounded-3xl">
          <h3 class="text-xl font-semibold mb-4 text-white">5-Day Forecast</h3>
          <div id="daily-forecast-list" class="space-y-3">
            <!-- Daily items will be injected here -->
          </div>
        </div>

        <!-- About Mock Data -->
        <div class="text-center text-sm text-gray-500 pt-4">
          <footer
            class="text-center text-sm text-gray-500 dark:text-gray-400 py-4 border-t"
          >
            © 2025 All Rights Reserved | Made with ❤️ by
            <span class="font-semibold text-blue-500">Harsh Kunde</span> using
            <span class="font-medium">HTML</span>,
            <span class="font-medium">Tailwind CSS</span>,
            <span class="font-medium">JavaScript</span>, and
            <span class="font-medium">Weather API</span>.
          </footer>
        </div>
      </main>
    </div>

    <script>
      // Global utility functions and configuration
      const appId =
        typeof __app_id !== "undefined" ? __app_id : "default-app-id";

      // --- API Configuration ---
      const API_KEY = "5bae7f8589b0082e63a8eebe11b7b931";
      const API_BASE_URL = "https://api.weatherstack.com/current";
      // -------------------------

      // State for managing units: 'm' for metric, 'f' for imperial
      let currentUnits = "m"; // Default to metric (°C, km/h, hPa)

      const selectors = {
        input: document.getElementById("city-input"),
        searchButton: document.getElementById("search-button"),
        unitToggle: document.getElementById("unit-toggle"),
        messageBox: document.getElementById("message-box"),
        loadingIndicator: document.getElementById("loading-indicator"),
        weatherContainer: document.getElementById("weather-container"),
        locationName: document.getElementById("location-name"),
        currentTime: document.getElementById("current-time"),
        weatherIconWrapper: document.getElementById("weather-icon-wrapper"),
        weatherIcon: document.getElementById("weather-icon"),
        currentTemp: document.getElementById("current-temp"),
        weatherDescription: document.getElementById("weather-description"),
        windSpeed: document.getElementById("wind-speed"),
        windUnit: document.getElementById("wind-unit"),
        humidity: document.getElementById("humidity"),
        uvIndex: document.getElementById("uv-index"),
        pressure: document.getElementById("pressure"),
        pressureUnit: document.getElementById("pressure-unit"),
        hourlyList: document.getElementById("hourly-forecast-list"),
        dailyList: document.getElementById("daily-forecast-list"),
        currentWeatherCard: document.getElementById("current-weather"), // Ref to main card
      };

      const weatherIcons = {
        "01d": "☀️",
        "01n": "🌙", // Sun/Clear
        "02d": "🌤️",
        "02n": "☁️", // Partly Cloudy
        "03d": "☁️",
        "03n": "☁️", // Cloudy
        "04d": " overcast ",
        "04n": " overcast ", // Overcast/Dense Clouds
        "09d": "🌧️",
        "09n": "🌧️", // Drizzle/Light Rain
        "10d": "🌦️",
        "10n": "🌧️", // Rain
        "11d": "⛈️",
        "11n": "⛈️", // Thunderstorm
        "13d": "❄️",
        "13n": "❄️", // Snow
        "50d": "🌫️",
        "50n": "🌫️", // Mist/Fog
      };

      // Mapping Weatherstack numeric codes to the app's internal icon codes (based on common codes)
      const weatherCodeToAppIcon = {
        113: "01d", // Clear/Sunny
        116: "02d", // Partly cloudy
        119: "03d", // Cloudy
        122: "04d", // Overcast
        143: "50d", // Mist
        176: "10d", // Patchy rain nearby
        185: "10d", // Patchy drizzle nearby
        200: "11d", // Thundery outbreaks nearby
        227: "13d", // Patchy snow
        230: "13d", // Blizzard
        248: "50d", // Fog
        260: "50d", // Freezing fog
        263: "09d", // Patchy light drizzle
        266: "09d", // Light drizzle
        293: "09d", // Patchy light rain
        296: "09d", // Light rain
        302: "10d", // Moderate rain
        338: "13d", // Heavy snow
        default: "04d", // Default to overcast if code is unknown
      };

      /**
       * Converts Weatherstack numeric code to the app's emoji icon key, accounting for day/night.
       */
      const getAppIconCode = (weatherCode, isDay) => {
        let code =
          weatherCodeToAppIcon[weatherCode] || weatherCodeToAppIcon.default;

        // Adjust to night icon if it's night time
        if (!isDay && code.endsWith("d")) {
          code = code.replace("d", "n");
        } else if (isDay && code.endsWith("n")) {
          code = code.replace("n", "d");
        }
        return code;
      };

      /**
       * Returns dynamic Tailwind classes based on weather description for the glassmorphic style.
       */
      function getWeatherStyle(description) {
        const desc = description.toLowerCase();

        // Clear default classes
        selectors.currentWeatherCard.className =
          "card p-8 md:p-10 rounded-3xl flex flex-col md:flex-row items-center justify-between transition-all duration-500";
        selectors.weatherIconWrapper.className =
          "p-4 rounded-full border-2 border-white/20 transition-all duration-500 shadow-xl";

        if (desc.includes("sun") || desc.includes("clear")) {
          // Warm, clear gradient
          selectors.currentWeatherCard.classList.add(
            "bg-gradient-to-br",
            "from-yellow-600/50",
            "to-orange-700/50",
            "border-yellow-300/30"
          );
          selectors.weatherIconWrapper.classList.add(
            "bg-yellow-400/40",
            "border-yellow-200/50",
            "shadow-yellow-500/50"
          );
        } else if (desc.includes("cloud") || desc.includes("overcast")) {
          // Gray, cloudy gradient
          selectors.currentWeatherCard.classList.add(
            "bg-gradient-to-br",
            "from-gray-600/50",
            "to-gray-800/50",
            "border-gray-300/30"
          );
          selectors.weatherIconWrapper.classList.add(
            "bg-gray-400/40",
            "border-gray-200/50",
            "shadow-gray-500/50"
          );
        } else if (desc.includes("rain") || desc.includes("drizzle")) {
          // Blue, rainy gradient
          selectors.currentWeatherCard.classList.add(
            "bg-gradient-to-br",
            "from-blue-600/50",
            "to-indigo-700/50",
            "border-blue-300/30"
          );
          selectors.weatherIconWrapper.classList.add(
            "bg-blue-400/40",
            "border-blue-200/50",
            "shadow-blue-500/50"
          );
        } else if (desc.includes("snow") || desc.includes("sleet")) {
          // Light blue, snow gradient
          selectors.currentWeatherCard.classList.add(
            "bg-gradient-to-br",
            "from-cyan-500/50",
            "to-blue-600/50",
            "border-cyan-300/30"
          );
          selectors.weatherIconWrapper.classList.add(
            "bg-cyan-300/40",
            "border-cyan-100/50",
            "shadow-cyan-500/50"
          );
        } else if (desc.includes("thunder") || desc.includes("storm")) {
          // Dark purple, storm gradient
          selectors.currentWeatherCard.classList.add(
            "bg-gradient-to-br",
            "from-purple-700/50",
            "to-gray-900/50",
            "border-purple-300/30"
          );
          selectors.weatherIconWrapper.classList.add(
            "bg-purple-500/40",
            "border-purple-300/50",
            "shadow-purple-500/50"
          );
        } else {
          // Default gradient
          selectors.currentWeatherCard.classList.add(
            "bg-gradient-to-br",
            "from-gray-700/50",
            "to-gray-800/50",
            "border-gray-300/30"
          );
          selectors.weatherIconWrapper.classList.add(
            "bg-gray-600/40",
            "border-gray-400/50",
            "shadow-gray-500/50"
          );
        }
      }

      // --- Mock Data Simulation for Hourly/Daily (since free API lacks them) ---
      /**
       * Generates mock hourly and daily forecast data based on real current conditions.
       * @param {object} currentData - Real current weather data to base the mock on.
       * @param {string} unit - 'm' or 'f'.
       */
      const generateMockData = (currentData, unit) => {
        const date = new Date();
        const baseTemp = currentData.temp;
        const baseIcon = currentData.iconCode;
        const tempSymbol = unit === "m" ? "°C" : "°F";

        // Generate Hourly Forecast (24 entries)
        const hourlyForecast = [];
        for (let i = 0; i < 24; i++) {
          const hour = (date.getHours() + i) % 24;
          const displayTime = i === 0 ? "Now" : `${hour}:00`;
          const isNight = hour >= 20 || hour < 6;
          const tempDelta = Math.floor(Math.random() * 5) - 2; // -2 to +2 variation

          let hourIcon = baseIcon;
          // Dynamically adjust icon for day/night
          if (isNight && hourIcon.endsWith("d")) {
            hourIcon = hourIcon.replace("d", "n");
          } else if (!isNight && hourIcon.endsWith("n")) {
            hourIcon = hourIcon.replace("n", "d");
          }

          // Simulate temporary change in conditions every 6 hours
          if (i % 6 === 0 && i !== 0) {
            const tempChangeCode = isNight ? "10n" : "10d"; // Rain for a change
            hourIcon = Math.random() > 0.8 ? tempChangeCode : hourIcon;
          }

          hourlyForecast.push({
            time: displayTime,
            temp: baseTemp + tempDelta,
            iconCode: hourIcon,
            symbol: tempSymbol,
          });
        }

        // Generate Daily Forecast (5 entries)
        const dailyForecast = [];
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        for (let i = 0; i < 5; i++) {
          const nextDay = new Date();
          nextDay.setDate(date.getDate() + i + 1);
          const dayName = dayNames[nextDay.getDay()];

          // Max/Min temperatures based on baseTemp, adjusted for units
          let maxDelta, minDelta;
          if (unit === "m") {
            // Celsius logic
            maxDelta = 3 + Math.floor(Math.random() * 4); // +3 to +6
            minDelta = -5 - Math.floor(Math.random() * 3); // -5 to -7
          } else {
            // Fahrenheit logic (larger range)
            maxDelta = 5 + Math.floor(Math.random() * 8); // +5 to +12
            minDelta = -8 - Math.floor(Math.random() * 6); // -8 to -13
          }

          dailyForecast.push({
            day: dayName,
            max: Math.round(baseTemp + maxDelta),
            min: Math.round(baseTemp + minDelta),
            iconCode: i % 3 === 0 ? "01d" : baseIcon.replace("n", "d"), // Ensure day icon for daily forecast
            symbol: tempSymbol,
          });
        }

        return { hourly: hourlyForecast, daily: dailyForecast };
      };

      // --- Core API Fetch Function ---

      /**
       * Fetches weather data from the Weatherstack API, using the current unit setting.
       * @param {string} city - The city name to fetch weather for.
       */
      async function fetchWeather(city) {
        if (!city || city.trim() === "") {
          throw new Error("Please enter a valid city name.");
        }

        // Append units parameter to the URL
        const url = `${API_BASE_URL}?access_key=${API_KEY}&query=${encodeURIComponent(
          city.trim()
        )}&units=${currentUnits}`;
        console.log(
          `[${appId}] Fetching weather from Weatherstack for: ${city} with units: ${currentUnits}`
        );

        try {
          // Implementing simple exponential backoff for retries
          let response;
          let apiData;
          const maxRetries = 3;

          for (let i = 0; i < maxRetries; i++) {
            response = await fetch(url);
            if (response.status !== 429) break; // If not rate limit, proceed

            // If rate limited (429), wait and retry
            const delay = Math.pow(2, i) * 1000;
            await new Promise((resolve) => setTimeout(resolve, delay));
          }

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          apiData = await response.json();

          // Check for Weatherstack API error (e.g., invalid city)
          if (apiData.error) {
            throw new Error(
              `API Error: ${
                apiData.error.info || "City not found or API limit reached."
              }`
            );
          }

          const currentWS = apiData.current;
          const locationWS = apiData.location;

          const isDay = currentWS.is_day === "yes";
          const tempSymbol = currentUnits === "m" ? "°C" : "°F";
          const windSymbol = currentUnits === "m" ? "km/h" : "mph";
          // Weatherstack uses hPa for metric and in for imperial pressure
          const pressureSymbol = currentUnits === "m" ? "hPa" : "in";

          // 1. Map real current data to app structure
          const appIconCode = getAppIconCode(currentWS.weather_code, isDay);

          const realCurrentData = {
            temp: Math.round(currentWS.temperature), // Round temp for cleaner display
            description: currentWS.weather_descriptions[0],
            iconCode: appIconCode,
            humidity: currentWS.humidity,
            windSpeed: currentWS.wind_speed,
            pressure: currentWS.pressure,
            uvIndex: currentWS.uv_index,
            time: locationWS.localtime.split(" ")[1],
            tempSymbol: tempSymbol,
            windSymbol: windSymbol,
            pressureSymbol: pressureSymbol,
          };

          // 2. Generate mock hourly/daily data based on the real current conditions
          const mockForecasts = generateMockData(realCurrentData, currentUnits);

          return {
            location: locationWS.name,
            current: realCurrentData,
            hourly: mockForecasts.hourly,
            daily: mockForecasts.daily,
          };
        } catch (error) {
          console.error("API Fetch Error:", error);
          throw new Error(
            `Failed to retrieve data. ${
              error.message || "Please check your network connection."
            }`
          );
        }
      }

      /**
       * Renders the fetched weather data to the UI.
       * @param {object} data - The weather data object.
       */
      function renderWeather(data) {
        const { current, hourly, daily, location } = data;

        // Apply dynamic glassmorphic card styling based on weather description
        getWeatherStyle(current.description);

        // 1. Current Weather (Live Data)
        selectors.locationName.textContent = location;
        selectors.currentTime.textContent = `Local Time: ${current.time}`;
        selectors.weatherIcon.textContent =
          weatherIcons[current.iconCode] || "❓";
        selectors.currentTemp.innerHTML = `${current.temp}${current.tempSymbol}`;
        selectors.weatherDescription.textContent = current.description;

        selectors.windSpeed.textContent = `${current.windSpeed}`;
        selectors.windUnit.textContent = `Wind (${current.windSymbol})`;

        selectors.humidity.textContent = `${current.humidity}%`;
        selectors.uvIndex.textContent = `${current.uvIndex}`;

        selectors.pressure.textContent = `${current.pressure}`;
        selectors.pressureUnit.textContent = `Pressure (${current.pressureSymbol})`;

        // 2. Hourly Forecast (Grounded Mock Data)
        selectors.hourlyList.innerHTML = ""; // Clear existing
        hourly.forEach((hour) => {
          const item = document.createElement("div");
          // Use a subtle glass card for hourly items
          item.className =
            "flex flex-col items-center p-3 card rounded-xl min-w-[80px] hover:bg-white/10 transition duration-150 border-transparent";
          item.innerHTML = `
                    <p class="text-sm font-medium text-gray-300">${
                      hour.time
                    }</p>
                    <div class="text-3xl my-2">${
                      weatherIcons[hour.iconCode] || "❓"
                    }</div>
                    <p class="text-lg font-bold">${hour.temp}${hour.symbol}</p>
                `;
          selectors.hourlyList.appendChild(item);
        });

        // 3. Daily Forecast (Grounded Mock Data)
        selectors.dailyList.innerHTML = ""; // Clear existing
        daily.forEach((day) => {
          const item = document.createElement("div");
          item.className =
            "flex justify-between items-center p-4 card rounded-xl hover:bg-white/10 transition duration-150 border-transparent";
          item.innerHTML = `
                    <div class="text-lg font-semibold w-1/4">${day.day}</div>
                    <div class="text-3xl w-1/4 text-center">${
                      weatherIcons[day.iconCode] || "❓"
                    }</div>
                    <div class="w-1/4 text-right">
                        <span class="text-lg font-bold">${day.max}${
            day.symbol
          }</span>
                        <span class="text-base text-gray-400 ml-2">${day.min}${
            day.symbol
          }</span>
                    </div>
                `;
          selectors.dailyList.appendChild(item);
        });

        selectors.weatherContainer.classList.remove("hidden");
      }

      /**
       * Toggles between Metric and Imperial units and reruns the search.
       */
      function handleUnitToggle() {
        if (currentUnits === "m") {
          currentUnits = "f";
          selectors.unitToggle.textContent = "Switch to °C";
        } else {
          currentUnits = "m";
          selectors.unitToggle.textContent = "Switch to °F";
        }
        // Re-fetch weather with the new unit setting
        handleSearch();
      }

      /**
       * Main handler for fetching and displaying weather.
       */
      async function handleSearch() {
        const city = selectors.input.value.trim();

        if (!city) {
          showMessage("Please enter a city name.", "bg-yellow-600");
          return;
        }

        // Reset UI
        selectors.weatherContainer.classList.add("hidden");
        selectors.messageBox.classList.add("hidden");
        selectors.loadingIndicator.classList.remove("hidden");

        try {
          const data = await fetchWeather(city);
          renderWeather(data);
          showMessage(
            `Forecast for ${data.location} successfully loaded in ${
              currentUnits === "m" ? "Metric" : "Imperial"
            } units.`,
            "bg-green-600"
          );
        } catch (error) {
          console.error("Weather fetching error:", error);
          showMessage(
            error.message || "Failed to fetch weather data. Please try again.",
            "bg-red-600"
          );
        } finally {
          selectors.loadingIndicator.classList.add("hidden");
        }
      }

      /**
       * Displays a temporary message box.
       * @param {string} message - The message content.
       * @param {string} bgColorClass - Tailwind class for background color (e.g., 'bg-red-600').
       */
      function showMessage(message, bgColorClass) {
        selectors.messageBox.textContent = message;
        selectors.messageBox.className = `mt-4 p-3 ${bgColorClass} text-white rounded-lg font-medium backdrop-blur-sm`;
        selectors.messageBox.classList.remove("hidden");

        // Hide the message after 5 seconds if not an error
        if (bgColorClass.includes("green") || bgColorClass.includes("yellow")) {
          setTimeout(() => selectors.messageBox.classList.add("hidden"), 5000);
        }
      }

      // --- Event Listeners and Initialization ---

      selectors.searchButton.addEventListener("click", handleSearch);
      selectors.unitToggle.addEventListener("click", handleUnitToggle); // New listener for unit toggle
      selectors.input.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          handleSearch();
        }
      });

      // Initialize with a default city on load
      window.onload = () => {
        handleSearch();
      };
    </script>
  </body>
</html>
